# 리팩터링 원칙

## 2.1 리팩터링 정의

> 리팩터링
> [명사] 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법
> [동사] 소프트웨어의 겉보기 동작은 그대로 유지한 채, 여러 가지 리팩터링 기법을 적용해서 소프트웨어를 재구성하다.

> 누군가 "리팩터링하다가 코드가 깨져서 며칠이나 고생했다."라고 한다면, 십중팔구 리팩터링한 것이 아니다.

리팩터링의 단계를 잘게 나눔으로써 우리는 디벙기하는 데 시간을 뺏기지 않을 수 있습니다.

리팩터링의 목적은 코드를 이해하고 수정하기 쉽게 만드는 것입니다. 이 과정에서 콜 스택이 달라지면서 성능이 변할 수도 있습니다. 반면, 성능 최적화는 오로지 속도 개선에만 신경쓰면서 코드를 다루는 것이 복잡해 질 수 있습니다.

## 2.2 두개의 모자

켄트 벡은 소프트웨어를 개발할 때의 목적을 두 개의 모자에 비유했습니다. `기능 추가` 모자를 썻을 때는 새 기능을 추가하고 테스트 코드를 추가하는지 확인하며 진척도를 측정합니다. 반면 `리팩토링` 모자를 썼을 때는 기능 추가 없이 오로지 코드 재구성에만 전념합니다. 이 때, 새로운 기능 추가 시 테스트 케이스를 놓쳤거나, 인터페이스가 변경하는 경우가 아니라면 테스트를 건드려서는 안 됩니다.

## 2.3 리팩터링하는 이유

### 리팩터링하면 소프트웨어 설계가 좋아진다

코드만으로 설계를 파악하기 어려워질수록 설계를 유지하기 어려워진다. 규칙적인 리팩터링은 코드 구조를 지탱해줍니다.

코드가 길수록 실수 없이 수정하기 어려워집니다. 이해해야 할 코드량이 늘어나고, 비슷한 일을 하는 코드가 산재해있으면 시스템이 예상대로 작동하지 않을 수 있습니다.

### 리팩터링하면 소프트웨어를 이해하기 쉬워진다.

내 소스 코드를 읽는 것은 컴퓨터뿐만이 아닙니다. 언젠가 다른 사람이, 내가 다시 코드를 읽었을 때 의도를 쉽게 파악하고 빠르게 목적을 달성할 수 있어야 합니다.

### 리팩터링하면 버그를 쉽게 찾을 수 있다.

코드를 이해하기 쉽다는 말은 버그를 찾기 쉽다는 말이기도 합니다. 프로그램의 구조를 명확히 다듬으면 '이럴 것이다'라고 가정하던 점들이 드러나며, 버그를 지나치고 싶어도 지나칠 수 없을 정도로 명확해집니다.

### 리팩터링면 프로그래밍 속도를 높일 수 있다.

내부 품질이 뛰어난 코드베이스는 새 기능 구축을 돕는 견고한 토대가 됩니다.

## 2.4 언제 리팩터링해야 할까?

### 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기

가장 좋은 시점은 코드베이스에 기능을 새로 추가하기 직전입니다. 구조를 살짝 바꾸면 다른 작업을 하기가 훨씬 쉬워질 부분을 찾습니다. 

버그를 잡을 때도 마찬가지입니다. 오류를 일으키는 코드가 세 곳에 복제되어 퍼져 있다면, 한곳으로 합치는 편이 작업하기에 훨씬 편합니다.

### 이해를 위한 리팩터링: 코드를 이해하기 쉽게 만들기

리팩터링하면 코드를 읽고 이해하는 것을 코드에 옮겨 담을 수 있습니다. 이후 테스트 코드를 돌려보면서 머리로 이해한 것이 맞는지 확인할 수 있습니다.

### 쓰레기 줍기 리팩터링

코드 파악 중에 비효율적으로 처리하는 모습을 발견할 수도 있습니다. 하지만 원래 하려던 작업과 관련 없는 일에 몰두할 시간은 충분치 않습니다. 이때, 당장 수정할 수 있는 것만 손대고, 시간이 걸리는 것들은 짧은 메모만 남긴 뒤 원래 작업을 끝내고 처리합니다. 이것을 쓰레기 줍기 리팩터링이라고 합니다.

캠핑 규칙이 제안하듯, 항상 처음 봤을 때보다 깔끔하게 정리합시다. 코드를 훑어볼 때마다 조금씩 개선하다 보면 결국 문제가 해결될 것입니다.

### 계획된 리팩터링과 수시로 하는 리팩터링

리팩터링은 프로그래밍과 구분되는 별개의 활동이 아닙니다. 마치 프로그래밍할 때 if 문 작성 시간을 따로 구분하지 않는 것과 같습니다.

> 보기 싫은 코드를 발견하면 리팩터링하자. 그런데 잘 작성된 코드 역시 수많은 리팩터링을 거쳐야 한다.

보기 싫은 코드를 보면 리팩터링해야 함은 당연하지만, 잘 작성된 코드 역시 수많은 리팩터링을 거쳐야 합니다.

> 무언가를 수정하려 할 때는 먼저 수정하기 쉽게 정돈하고(단, 만만치 않을 수 있다.) 그런 다음 쉽게 수정하자.

소프트에어는 새 기능이 필요할 때마다 이를 반영하기 위해 수정됩니다. 이때 새로 작성해 넣은 코드보다 기존 코드의 수정량이 큰 경우가 대체로 많습니다.

그렇다고 해서 계획된 리팩토링이 나쁜 것은 아닙니다. 그동안 리팩터링에 소홀했다면, 따로 시간을 내서 새 기능을 추가하기 쉽도록 코드베이스를 개선할 필요가 있습니다. 하지만 이런 이유로 계획된 리팩터링을 하게 되는 일은 최소한으로 줄여야 한다고 저자는 말합니다. 리팩터링은 대부분은 드러나지 않게, 기회가 될 때마다 해야 합니다.

기능 추가 커밋과 리팩터링 커심을 분리할지 분리하지 않을지는 실험을 통해 팀에 적합한 방식을 찾아야 한다고 말합니다.

### 오래 걸릴는 리팩터링

저자는 팀원 전체가 오래 걸리는 리팩터링에 달려들기 보다 누구든지 관련 작업을 할 때마다 원하는 방향으로 조금씩 개선하는 것이 효과적이라 합니다. 예컨대 의존성을 역전시켜 기존 코드가 인터페이스를 호출하도록 만들고 라이브러리를 쉽게 교체하는 것입니다.
